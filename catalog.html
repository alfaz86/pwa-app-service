<div class="p-3 sticky-top">
    <div class="d-flex justify-content-between">
        <button class="d-inline w-auto input-group-text btn btn-filter select-type" type="button" id="all" onclick="setType('all')">
            All
        </button>
        <button class="d-inline w-auto input-group-text btn btn-filter" type="button" id="sparepart" onclick="setType('sparepart')">
            Sparepart
        </button>
        <button class="d-inline w-auto input-group-text btn btn-filter" type="button" id="oli" onclick="setType('oli')">
            Oli
        </button>
        <button class="d-inline w-auto input-group-text btn btn-filter" type="button" id="accessories" onclick="setType('accessories')">
            Aksesoris
        </button>
    </div>
    <div class="form-inline mt-3">
        <div class="input-group mb-2 w-100">
            <input class="form-control p-4 input-search" type="search" name="search" id="search" placeholder="Cari..." aria-label="Cari..." autocomplete="off" style="margin-right: 10px !important;">
            <div class="input-group">
                <button class="input-group-text btn btn-outline-success" type="button" id="search-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search ml-2 mr-2" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>
</div>
<div class="container-products w-100 px-2">
    <div
        id="load_data"
        class="container-product d-flex justify-content-start d-flex w-100 flex-wrap">
    </div>
    <div id="load_data_message" class="container-product d-flex justifycontent-start d-flex w-100 flex-wrap">
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="modalCatalog" tabindex="-1" aria-labelledby="modalCatalogLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form id="create-catalog">
                <div class="modal-header">
                    <h5 class="modal-title">Tambah Data</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="name">Nama Produk</label>
                        <input type="text" class="form-control" id="name" name="name" autocomplete="off" required>
                    </div>
                    <div class="form-group">
                        <label for="price">Harga</label>
                        <input type="text" class="form-control" id="price" name="price" autocomplete="off" required>
                    </div>
                    <div class="form-group">
                        <label for="type">Tipe</label>
                        <select class="form-control" name="type" id="type" required>
                            <option value="sparepart">Sparepart</option>
                            <option value="oli">Oli</option>
                            <option value="accessories">Accessories</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="img">Gambar</label>
                        <div class="custom-file">
                            <input type="file" class="custom-file-input" id="img" name="img" required>
                            <label class="custom-file-label" id="custom-file-label">Upload gambar...</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal Edit -->
<div class="modal fade" id="modalEditCatalog" tabindex="-1" aria-labelledby="modalEditCatalogLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form id="edit-catalog">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Data</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="name-edit">Nama Produk</label>
                        <input type="text" class="form-control" id="name-edit" name="name-edit" autocomplete="off" required>
                        <input type="hidden" class="form-control" id="id" name="id" autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label for="price-edit">Harga</label>
                        <input type="text" class="form-control" id="price-edit" name="price-edit" autocomplete="off" required>
                    </div>
                    <div class="form-group">
                        <label for="type-edit">Tipe</label>
                        <select class="form-control" name="type-edit" id="type-edit" required>
                            <option value="sparepart">Sparepart</option>
                            <option value="oli">Oli</option>
                            <option value="accessories">Accessories</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="img-edit">Gambar</label>
                        <div class="custom-file">
                            <input type="file" class="custom-file-input" id="img-edit" name="img-edit">
                            <label class="custom-file-label" id="custom-file-label-edit">Upload gambar...</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-danger" onclick="deleteCatalog(this)" id="btn-delete" data-id="">Hapus</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<button class="btn btn-outline-theme" type="button" id="btn-add-catalog" data-toggle="modal" data-target="#modalCatalog">
    <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
    </svg>
</button>

<script>
    if (!checkRole()) $('#btn-add-catalog').css('display', 'none');
    $("#search").on("keypress", (e) => {
        if (e.key === "Enter") search()
    });
    $("#search-btn").click(() => search());

    function search() {
        $("#load_data").html("");
        start = 0;
        name = $("#search").val();
        lazzy_loader(limit);
        if (action == "inactive") {
            action = "active";
            setTimeout(function () {
                fetch(limit, start, name, type);
            }, 1000);
        }
    }

    $('#img').change(function(e) {
        $('#custom-file-label').html(e.target.files[0].name);
        var reader = new FileReader();
        reader.onload = function(e) {
            img = e.target.result;
        };
        reader.readAsDataURL(this.files[0]);
    });

    $("form#create-catalog").submit(function(e) {
        e.preventDefault();
        let data = $(this).closest('form').serializeArray();
        data[data.length] = {
            name: 'img',
            value: img,
        }
        createCatalog(data);
    });

    $('#img-edit').change(function(e) {
        $('#custom-file-label-edit').html(e.target.files[0].name);
        var reader = new FileReader();
        reader.onload = function(e) {
            img_edit = e.target.result;
        };
        reader.readAsDataURL(this.files[0]);
    });

    $("form#edit-catalog").submit(function(e) {
        e.preventDefault();
        let form = $(this).closest('form').serializeArray();
        form[form.length] = {
            name: 'img',
            value: img_edit,
        }
        data = {};
        form.forEach( (v, i) => {
            key = v.name.replace("-edit", "")
            data[key] = v.value;
        });
        updateCatalog(data);
    });
</script>